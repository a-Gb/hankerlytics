<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Interactive visualization tool for exploring Hacker News discussion threads with multiple layouts, pan/zoom, and optional LLM analysis."
    />
    <meta name="theme-color" content="#0e131d" />
    <title>HN Thread Atlas</title>
    <link rel="icon" href="data:," />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="branding">
          <div class="brand-title">HN Thread Atlas</div>
          <div class="brand-subtitle">
            Map deep discussions without losing the thread.
          </div>
        </div>
        <div class="controls">
          <div class="control-group thread-controls">
            <label class="control wide">
              <span>Thread</span>
              <input
                id="thread-input"
                type="text"
                value="46616488"
                placeholder="HN item id or URL"
              />
            </label>
            <button id="load-btn" class="btn primary">Load</button>
            <button id="refresh-btn" class="btn">Refresh</button>
          </div>
          <div class="control-group layout-controls">
            <label class="control">
              <span>Layout</span>
              <select id="layout-select"></select>
            </label>
            <button id="fit-btn" class="btn">Fit</button>
            <button id="center-btn" class="btn">Center</button>
          </div>
          <div class="control-group feed-controls">
            <label class="control">
              <span>Feed</span>
              <select id="frontpage-kind">
                <option value="top" selected>Top</option>
                <option value="new">New</option>
                <option value="best">Best</option>
                <option value="ask">Ask</option>
                <option value="show">Show</option>
                <option value="job">Jobs</option>
              </select>
            </label>
            <label class="control small">
              <span>Limit</span>
              <input
                id="frontpage-limit"
                type="number"
                min="5"
                max="60"
                value="30"
              />
            </label>
            <button id="frontpage-refresh" class="btn">Refresh FP</button>
          </div>
        </div>
        <div id="stats" class="stats"></div>
      </header>

      <main class="main">
        <section class="graph-panel">
          <div id="graph-shell" class="graph-shell">
            <svg id="graph" role="img" aria-label="Hacker News thread graph">
              <defs>
                <linearGradient id="nodeGlow" x1="0" x2="1">
                  <stop offset="0%" stop-color="#6ee7ff" stop-opacity="0.75" />
                  <stop
                    offset="100%"
                    stop-color="#ffb36a"
                    stop-opacity="0.75"
                  />
                </linearGradient>
              </defs>
              <g id="graph-layer"></g>
            </svg>
            <div
              id="graph-tooltip"
              class="graph-tooltip"
              role="tooltip"
              aria-hidden="true"
            ></div>
            <div class="hud">
              <div class="hint">
                Scroll to zoom. Drag to pan. Double-click a node to collapse.
              </div>
              <div id="selection" class="selection-pill">Selected: none</div>
              <div id="status" class="status">Ready.</div>
            </div>
          </div>
        </section>

        <aside class="detail-panel">
          <div class="detail-card">
            <div class="detail-header">
              <h2 id="detail-title">Select a node</h2>
              <div id="detail-meta" class="detail-meta"></div>
            </div>
            <div id="detail-body" class="detail-body">
              Click a node to read its content and explore that branch.
            </div>
            <details id="branch-view" class="branch-view">
              <summary id="branch-summary">Branch view</summary>
              <div id="branch-body" class="branch-body"></div>
            </details>
            <div class="detail-actions">
              <button id="collapse-btn" class="btn" disabled>Collapse</button>
              <a
                id="hn-link"
                class="btn ghost"
                href="https://news.ycombinator.com"
                target="_blank"
                rel="noopener"
                >Open on HN</a
              >
            </div>
          </div>

          <div class="analysis-card">
            <div class="detail-header">
              <h3>Local LLM</h3>
              <div class="detail-meta">
                Send the selected context stack for analysis.
              </div>
            </div>
            <div class="analysis-grid">
              <label class="control">
                <span>Endpoint</span>
                <input
                  id="llm-endpoint"
                  type="text"
                  value="http://localhost:1234/api/v1/chat"
                />
              </label>
              <label class="control">
                <span>API</span>
                <select id="llm-api">
                  <option value="lmstudio">LM Studio /api/v1/chat</option>
                  <option value="responses">OpenAI-style /v1/responses</option>
                </select>
              </label>
              <label class="control">
                <span>Scope</span>
                <select id="llm-scope">
                  <option value="stack" selected>
                    Context stack (ancestors + replies)
                  </option>
                  <option value="subtree">Subtree only</option>
                  <option value="thread">Full thread</option>
                </select>
              </label>
              <label class="control">
                <span>Model</span>
                <input
                  id="llm-model"
                  type="text"
                  value="nvidia/nemotron-3-nano"
                  placeholder="nvidia/nemotron-3-nano"
                />
              </label>
              <label class="control">
                <span>Token (optional)</span>
                <input
                  id="llm-token"
                  type="password"
                  placeholder="Bearer token if needed"
                />
              </label>
            </div>
            <label class="control full">
              <span>System prompt</span>
              <textarea id="llm-system" rows="3">
You are a discussion analyst. Summarize the thread, list key branches, and surface the strongest arguments.</textarea
              >
            </label>
            <label class="control full">
              <span>Prompt</span>
              <textarea id="llm-prompt" rows="4">
Analyze the selected Hacker News thread. Provide: (1) 3-sentence overview, (2) top subtopics, (3) notable disagreements, (4) actionable insights.</textarea
              >
            </label>
            <div class="analysis-actions">
              <button id="llm-send" class="btn primary">
                Send selected stack
              </button>
              <button id="llm-load" class="btn">Load last</button>
              <label class="toggle">
                <input id="llm-autosend" type="checkbox" checked />
                <span>Auto-send on icicle click</span>
              </label>
              <label class="toggle">
                <input id="llm-sentiment" type="checkbox" checked />
                <span>Auto sentiment labels</span>
              </label>
            </div>
            <div id="llm-status" class="status-pill">Idle.</div>
            <div id="llm-output" class="analysis-output markdown">
              Response will appear here.
            </div>
          </div>

          <div class="legend-card">
            <h3>Legend</h3>
            <div class="legend-item">
              <span class="dot root"></span>
              <span>Story root</span>
            </div>
            <div class="legend-item">
              <span class="dot comment"></span>
              <span>Comment node</span>
            </div>
            <div class="legend-item">
              <span class="dot muted"></span>
              <span>Deleted / dead</span>
            </div>
            <div class="legend-item">
              <span class="dot selected"></span>
              <span>Selected</span>
            </div>
            <div class="legend-item">
              <span class="dot sentiment positive"></span>
              <span>Sentiment positive</span>
            </div>
            <div class="legend-item">
              <span class="dot sentiment negative"></span>
              <span>Sentiment negative</span>
            </div>
            <div class="legend-item">
              <span class="dot sentiment neutral"></span>
              <span>Sentiment neutral</span>
            </div>
            <div class="legend-item">
              <span class="dot sentiment mixed"></span>
              <span>Sentiment mixed</span>
            </div>
          </div>
        </aside>
      </main>
    </div>

    <noscript>This app needs JavaScript to load Hacker News data.</noscript>
    <script type="module" src="app.js"></script>
  </body>
</html>
